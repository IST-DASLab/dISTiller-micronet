# This is a stupid Efficientnetb0 scheduler
# it groups weights in order into 3 even groups

version: 1
pruners:
  low_pruner:
    class: AutomatedGradualPruner
    initial_sparsity: 0.10
    final_sparsity: 0.6
    weights: ["module._blocks.0._depthwise_conv.weight",
"module._blocks.0._se_reduce.weight",
"module._blocks.1._depthwise_conv.weight",
"module._blocks.1._se_reduce.weight",
"module._blocks.2._depthwise_conv.weight",
"module._blocks.2._se_reduce.weight",
"module._blocks.3._depthwise_conv.weight",
"module._blocks.3._se_reduce.weight",
"module._blocks.4._depthwise_conv.weight",
"module._blocks.4._se_reduce.weight",
"module._blocks.5._depthwise_conv.weight",
"module._blocks.5._se_reduce.weight",
"module._blocks.6._depthwise_conv.weight",
"module._blocks.6._se_reduce.weight",
"module._blocks.7._depthwise_conv.weight",
"module._blocks.7._se_reduce.weight",
"module._blocks.8._depthwise_conv.weight",
"module._blocks.8._se_reduce.weight",
"module._blocks.9._depthwise_conv.weight",
"module._blocks.9._se_reduce.weight",
"module._blocks.10._depthwise_conv.weight",
"module._blocks.10._se_reduce.weight",
"module._blocks.11._depthwise_conv.weight",
"module._blocks.11._se_reduce.weight",
"module._blocks.12._depthwise_conv.weight",
"module._blocks.12._se_reduce.weight",
"module._blocks.0._se_expand.weight",
"module._blocks.1._se_expand.weight",
"module._blocks.2._se_expand.weight",
"module._blocks.3._se_expand.weight",
"module._blocks.4._se_expand.weight",
"module._blocks.5._se_expand.weight",
"module._blocks.6._se_expand.weight",
"module._blocks.7._se_expand.weight",
"module._blocks.8._se_expand.weight",
"module._blocks.9._se_expand.weight",
"module._blocks.10._se_expand.weight",
"module._blocks.11._se_expand.weight",
"module._blocks.12._se_expand.weight",
]

  mid_pruner:
    class: AutomatedGradualPruner
    initial_sparsity: 0.6
    final_sparsity: 0.9
    weights: [
"module._blocks.5._project_conv.weight",
"module._blocks.6._expand_conv.weight",
"module._blocks.6._project_conv.weight",
"module._blocks.7._expand_conv.weight",
"module._blocks.7._project_conv.weight",
"module._blocks.8._expand_conv.weight",
"module._blocks.8._project_conv.weight",
"module._blocks.9._expand_conv.weight",
"module._blocks.9._project_conv.weight",
"module._blocks.10._expand_conv.weight",
"module._blocks.10._project_conv.weight",
"module._blocks.11._expand_conv.weight",
"module._blocks.11._project_conv.weight",
"module._blocks.12._expand_conv.weight",
"module._blocks.12._project_conv.weight",
"module._blocks.13._expand_conv.weight",
"module._blocks.13._project_conv.weight",
"module._blocks.14._expand_conv.weight",
"module._blocks.14._project_conv.weight",
"module._blocks.15._expand_conv.weight",
"module._blocks.15._project_conv.weight",
"module._blocks.16._expand_conv.weight",
"module._blocks.16._project_conv.weight",
"module._blocks.17._expand_conv.weight",
"module._blocks.17._project_conv.weight",
"module._blocks.18._expand_conv.weight",
"module._blocks.18._project_conv.weight",
"module._blocks.19._expand_conv.weight",
"module._blocks.19._project_conv.weight",
"module._blocks.20._expand_conv.weight",
"module._blocks.20._project_conv.weight",
"module._blocks.21._expand_conv.weight",
"module._blocks.21._project_conv.weight",
"module._blocks.22._expand_conv.weight",
"module._blocks.22._project_conv.weight"
]

  high_pruner:
    class: AutomatedGradualPruner
    initial_sparsity: 0.4
    final_sparsity: 0.45
    weights: ["module._conv_head.weight",
"module._fc.weight",
"module._blocks.0._project_conv.weight",
"module._blocks.1._project_conv.weight",
"module._blocks.2._expand_conv.weight",
"module._blocks.2._project_conv.weight",
"module._blocks.3._expand_conv.weight",
"module._blocks.3._project_conv.weight",
"module._blocks.4._expand_conv.weight",
"module._blocks.4._project_conv.weight",
"module._blocks.5._expand_conv.weight",]

  higher_pruner:
    class: AutomatedGradualPruner
    initial_sparsity: 0.45
    final_sparsity: 0.5
    weights: [
      "module._blocks.13._depthwise_conv.weight",
      "module._blocks.14._depthwise_conv.weight",
      "module._blocks.15._depthwise_conv.weight",
      "module._blocks.16._depthwise_conv.weight",
      "module._blocks.17._depthwise_conv.weight",
      "module._blocks.18._depthwise_conv.weight",
      "module._blocks.19._depthwise_conv.weight",
      "module._blocks.20._depthwise_conv.weight",
      "module._blocks.21._depthwise_conv.weight",
      "module._blocks.22._depthwise_conv.weight",
      "module._blocks.13._se_expand.weight",
      "module._blocks.14._se_expand.weight",
      "module._blocks.15._se_expand.weight",
      "module._blocks.16._se_expand.weight",
      "module._blocks.17._se_expand.weight",
      "module._blocks.18._se_expand.weight",
      "module._blocks.19._se_expand.weight",
      "module._blocks.20._se_expand.weight",
      "module._blocks.21._se_expand.weight",
      "module._blocks.22._se_expand.weight",
      "module._blocks.13._se_reduce.weight",
      "module._blocks.14._se_reduce.weight",
      "module._blocks.15._se_reduce.weight",
      "module._blocks.16._se_reduce.weight",
      "module._blocks.17._se_reduce.weight",
      "module._blocks.18._se_reduce.weight",
      "module._blocks.19._se_reduce.weight",
      "module._blocks.20._se_reduce.weight",
      "module._blocks.21._se_reduce.weight",
      "module._blocks.22._se_reduce.weight"
    ]

  begin_pruner:
    class: AutomatedGradualPruner
    initial_sparsity: 0.05
    final_sparsity: 0.1
    weights: ["module._conv_stem.weight", ]


lr_schedulers:
   pruning_lr:
     class: ExponentialLR
     gamma: 0.9


policies:
  - pruner:
      instance_name : low_pruner
    starting_epoch: 0
    ending_epoch: 11
    frequency: 10

  - pruner:
      instance_name : higher_pruner
    starting_epoch: 0
    ending_epoch: 11
    frequency: 10

  - pruner:
      instance_name : mid_pruner
    starting_epoch: 0
    ending_epoch: 11
    frequency: 10

  - pruner:
      instance_name : begin_pruner
    starting_epoch: 0
    ending_epoch: 11
    frequency: 10

  - pruner:
      instance_name : high_pruner
    starting_epoch: 0
    ending_epoch: 11
    frequency: 10

  - lr_scheduler:
      instance_name: pruning_lr
    starting_epoch: 0
    ending_epoch: 15
    frequency: 1

